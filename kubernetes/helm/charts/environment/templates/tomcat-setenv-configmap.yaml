apiVersion: v1
kind: ConfigMap
metadata:
  name: setenv-{{ .Release.Namespace }}
data:
  setenv.sh: |-
    export ENVIRONMENT_VERSION='{{ .Chart.Version }}'

    {{- range $key, $val := .Values.environment_vars }}
    export {{ $key }}={{ $val | replace "$" "\\$" | replace "!" "\\!" | replace "`" "\\`" | replace ";" "\\;" | replace " " "\\ " | replace ")" "\\)" | replace "(" "\\("}}
    {{- end}}

    export USERS_URL='http://user-integration-service-{{ .Release.Namespace }}.{{ .Release.Namespace }}.svc.cluster.local:8080/user-integration-service/v2/users'
    export ARRANGEMENTS_URL='http://arrangements-integration-service-{{ .Release.Namespace }}.{{ .Release.Namespace }}.svc.cluster.local:8080/arrangements-integration-service/v2/arrangements'
    export ACCESS_GROUP_URL='http://accessgroup-integration-service-{{ .Release.Namespace }}.{{ .Release.Namespace }}.svc.cluster.local:8080/accessgroup-integration-service/v2/accessgroups'
    export PRODUCT_URL='http://arrangements-integration-service-{{ .Release.Namespace }}.{{ .Release.Namespace }}.svc.cluster.local:8080/arrangements-integration-service/v2/products'
    export LEGAL_ENTITY_URL='http://legalentity-integration-service-{{ .Release.Namespace }}.{{ .Release.Namespace }}.svc.cluster.local:8080/legalentity-integration-service/v2/legalentities'

    export CATALINA_OPTS='-Dbackbase.api.mvc.big-decimal-json-serializer=false -Dendpoints.sensitive=false -Dendpoints.info.sensitive=false -Dendpoints.enabled=true -Dactivemq.url="tcp://activemq-{{ .Release.Namespace}}.{{ .Release.Namespace }}.svc.cluster.local:61616" -Dspring.activemq.broker-url="tcp://activemq-{{ .Release.Namespace }}.{{ .Release.Namespace }}.svc.cluster.local:61616" -Dserver.port=8080 -Dserver.name=$HOSTNAME -Dspring.datasource.url="{{ .Values.environment_vars.datasourceURL }}" -Dspring.jpa.database-platform=SQLServer2008 -Dspring.datasource.driver-class-name=com.microsoft.sqlserver.jdbc.SQLServerDriver -Dspring.jpa.show-sql=false -Dspring.jpa.hibernate.ddl-auto=none -Dspring.datasource.username="{{ .Values.environment_vars.datasourceUsername }}" -Dspring.datasource.password="{{ .Values.environment_vars.datasourcePassword }}" -Dliquibase.enabled=false -Dspring.jta.journal=bitronix.tm.journal.NullJournal -Dhystrix.command.default.execution.timeout.enabled=false -Dspring.cloud.circuit.breaker.enabled=false -Dgateway.registry.host="registry-{{ .Release.Namespace }}.{{ .Release.Namespace }}.svc.cluster.local:8080" -Dfile.encoding=UTF-8 -Dsun.jnu.encoding=UTF-8 -Djava.awt.headless=true -Djava.security.egd=file:/dev/./urandom -Dspring.jpa.hibernate.ddl-auto=none -Dsymxchange.url="{{ .Values.environment_vars.symxchangeUrl }}" -Dsymxchange.adminPassword="{{ .Values.environment_vars.SYMX_PASSWORD | replace "$" "\\$" }}" -Dsymxchange.deviceType="{{ .Values.environment_vars.symxchangeDeviceType }}" -Dsymxchange.deviceNumber="{{ .Values.environment_vars.symxchangeDeviceNumber }}" -Dsymxchange.cardPrefix="{{ .Values.environment_vars.symxchangeCardPrefix }}" -Dbuildingblocks.security.csrf.enabled=false -Dbackbase.communication.logRequests=false -Dbackbase.communication.logReplies=false -Dbackbase.communication.consumer-options.maxConcurrentConsumers=50 -Dbackbase.communication.consumer-options.maxMessagesPerTask=100 -Dbackbase.web.security.enabled=true -Dbackbase.eventsourcing.commands-and-events-storage-enabled=false -Dsso.jwt.internal.type=signed -Dsso.jwt.internal.signature.algorithm=HS256 -Dsso.jwt.internal.signature.key.type=ENV -Dsso.jwt.internal.signature.key.value=SIG_SECRET_KEY -Dbuildingblocks.security.csrf.enabled=false -agentlib:jdwp=transport=dt_socket,address=5009,suspend=n,server=y'

    export JAVA_OPTS='-Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.ssl=false -Dfile.encoding=UTF-8 -Dnet.sf.ehcache.skipUpdateCheck=true -Dspring.boot.admin.client.service-base-url="http://$POD_IP:8080" -Dspring.boot.admin.client.prefer-ip=true -Dspring.boot.admin.url="http://wsecu-admin-{{ .Release.Namespace }}.{{ .Release.Namespace }}.svc.cluster.local:8080/wsecu-admin" -Dspring.boot.admin.auto-deregistration=true -Dlogging.level.org.springframework.boot.web.support.ErrorPageFilter=OFF -Dlogging.level.root=WARN -Dlogging.level.com.backbase=WARN -Dlogging.level.org.springframework=WARN -Dlogging.level.com.netflix.discovery=OFF -Dlogging.level.com.backbase.bbb=WARN -Dlogging.level.com.backbase.buildingblocks=WARN -Dregistry.instance.public=true -Dregistry.instance.role=live -Dregistry.instance.nonSecurePort=8080 -Dregistry.client.serviceUrl=defaultZone="http://registry-{{ .Release.Namespace }}.{{ .Release.Namespace }}.svc.cluster.local:8080/registry/eureka/" -Dregistry.instance.leaseRenewalIntervalInSeconds=10 -Dregistry.instance.preferIpAddress=true -Dbackbase.sys2sys.claims.sub=sys2sys -Dbackbase.sys2sys.claims.rle=role -Dbackbase.sys2sys.claims.said=no -XX:+UseConcMarkSweepGC -XX:+CMSClassUnloadingEnabled -XX:+UseParNewGC -XX:MaxPermSize=128m -Xms1024m -Xmx4096m'